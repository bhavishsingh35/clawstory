{% extends "base.html" %}
{% block title %}My Account | ClawStory{% endblock %}

{% block content %}
<div class="bg-[#1a1a1a] -mx-4 px-4 py-10 min-h-[80vh] text-white">

<section class="max-w-6xl mx-auto" aria-labelledby="account-heading">

  <!-- ================= HEADER ================= -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-10">
    <h1
      id="account-heading"
      class="text-3xl font-extrabold tracking-tight"
    >
      My Account
    </h1>

    <!-- LOGOUT -->
    <form method="post" action="{% url 'accounts:logout' %}">
      {% csrf_token %}
      <button
        type="submit"
        aria-label="Logout from account"
        class="mt-3 sm:mt-0 text-sm text-[#c7b27c] hover:underline"
      >
        Logout
      </button>
    </form>
  </div>

  <!-- ================= STATS ================= -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-12">

    <div class="bg-[#111111] p-5 rounded-xl border border-gray-800">
      <p class="text-gray-400 text-sm">Total Orders</p>
      <p class="text-2xl font-bold mt-1">
        {{ total_orders }}
      </p>
    </div>

    <div class="bg-[#111111] p-5 rounded-xl border border-gray-800">
      <p class="text-gray-400 text-sm">Total Spent</p>
      <p class="text-2xl font-bold mt-1">
        ₹{{ total_spent|floatformat:2 }}
      </p>
    </div>

    <div class="bg-[#111111] p-5 rounded-xl border border-gray-800">
      <p class="text-gray-400 text-sm">Account Status</p>
      {% if user.is_active %}
        <p class="text-green-400 font-semibold mt-1">Active</p>
      {% else %}
        <p class="text-red-400 font-semibold mt-1">Inactive</p>
      {% endif %}
    </div>

  </div>

  <!-- ================= ORDER HISTORY ================= -->
  <section
    class="bg-[#111111] rounded-xl border border-gray-800 overflow-hidden"
    aria-labelledby="order-history-heading"
  >

    <div class="px-6 py-4 border-b border-gray-800">
      <h2
        id="order-history-heading"
        class="text-xl font-semibold"
      >
        Order History
      </h2>
    </div>

    {% if orders %}
    <div class="divide-y divide-gray-800">

      {% for order in orders %}
      <div class="px-6 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

        <!-- LEFT -->
        <div>
          <p class="font-semibold break-all">
            Order #{{ order.id }}
          </p>
          <p class="text-sm text-gray-400">
            {{ order.created_at|date:"d M Y, h:i A" }}
          </p>
        </div>

        <!-- RIGHT -->
        <div class="flex flex-wrap items-center gap-4">

          <span class="font-semibold">
            ₹{{ order.total_amount|floatformat:2 }}
          </span>

          <span
            class="px-3 py-1 rounded-full text-xs font-medium
            {% if order.payment_status == 'SUCCESS' %}
              bg-green-900/40 text-green-400
            {% elif order.payment_status == 'FAILED' %}
              bg-red-900/40 text-red-400
            {% else %}
              bg-yellow-900/40 text-yellow-400
            {% endif %}
            "
          >
            {% if order.payment_status == "SUCCESS" %}
              Paid
            {% elif order.payment_status == "FAILED" %}
              Failed
            {% else %}
              Pending
            {% endif %}
          </span>

          <a
            href="{% url 'orders:order_detail' order.id %}"
            class="text-sm px-4 py-2 bg-[#1a1a1a] border border-gray-700 rounded-lg hover:border-[#c7b27c] transition"
          >
            View Order
          </a>

        </div>
      </div>
      {% endfor %}

    </div>

    {% else %}
    <!-- EMPTY STATE -->
    <div class="p-10 text-center text-gray-400">
      <p class="mb-6">
        You haven’t placed any orders yet.
      </p>
      <a
        href="{% url 'pages:shop' %}"
        class="inline-block px-8 py-3 bg-[#c7b27c] text-black rounded-xl font-semibold hover:bg-[#bfa764] transition"
      >
        Start Shopping
      </a>
    </div>
    {% endif %}

  </section>

</section>
</div>
{% endblock %}
