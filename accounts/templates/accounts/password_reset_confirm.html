{% extends "auth_base.html" %}
{% block title %}Set New Password | ClawStory{% endblock %}

{% block heading %}Set New Password{% endblock %}
{% block subheading %}
Create a strong password to secure your account
{% endblock %}

{% block content %}

{% if validlink %}

  <!-- ================= ICON ================= -->
  <div
    class="mx-auto mb-4 flex h-14 w-14 items-center justify-center
           rounded-full bg-[#c7b27c]/20 text-[#c7b27c]"
    aria-hidden="true"
  >
    ðŸ”’
  </div>

  <!-- ================= FORM ERRORS ================= -->
  {% if form.non_field_errors %}
    <div class="mb-4 text-sm px-3 py-2 rounded-md
                bg-red-900/30 text-red-400 border border-red-800">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <!-- ================= FORM ================= -->
  <form method="post" class="space-y-4" novalidate>
    {% csrf_token %}

    <!-- NEW PASSWORD -->
    <div>
      <label class="block text-sm font-medium mb-1 text-gray-300">
        New password
      </label>

      {{ form.new_password1 }}

      <p class="mt-1 text-xs text-gray-500">
        Minimum 8 characters. Avoid common passwords.
      </p>

      {% if form.new_password1.errors %}
        <p class="mt-1 text-xs text-red-400">
          {{ form.new_password1.errors|striptags }}
        </p>
      {% endif %}
    </div>

    <!-- CONFIRM PASSWORD -->
    <div>
      <label class="block text-sm font-medium mb-1 text-gray-300">
        Confirm new password
      </label>

      {{ form.new_password2 }}

      {% if form.new_password2.errors %}
        <p class="mt-1 text-xs text-red-400">
          {{ form.new_password2.errors|striptags }}
        </p>
      {% endif %}
    </div>

    <!-- SUBMIT -->
    <button
      type="submit"
      class="w-full bg-[#c7b27c] text-black py-2.5 rounded-md
             font-semibold hover:bg-[#bfa764]
             transition min-h-[44px]"
    >
      Update password
    </button>

  </form>

{% else %}

  <!-- ================= INVALID LINK ================= -->
  <div class="text-center space-y-4">

    <div
      class="mx-auto h-14 w-14 flex items-center justify-center
             rounded-full bg-red-900/30 text-red-400"
    >
      âš 
    </div>

    <p class="text-sm text-gray-400">
      This password reset link is invalid or has already been used.
    </p>

    <a
      href="{% url 'accounts:forgot_password' %}"
      class="block w-full bg-[#c7b27c] text-black py-2.5 rounded-md
             font-semibold hover:bg-[#bfa764] transition"
    >
      Request new reset link
    </a>

  </div>

{% endif %}

{% endblock %}
