{% extends "base.html" %}
{% block title %}My Orders | ClawStory{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-10">

<h1 class="text-3xl font-extrabold mb-8">My Orders</h1>

{% if orders_data %}
<div class="space-y-8">

{% for data in orders_data %}
{% with order=data.order current=data.current_step %}
<div class="bg-white rounded-2xl shadow">

<div class="p-6 border-b flex justify-between">
  <div>
    <p class="font-semibold text-lg">Order #{{ order.id }}</p>
    <p class="text-sm text-gray-500">
      {{ order.created_at|date:"d M Y, h:i A" }}
    </p>
  </div>
  <span class="px-4 py-1 rounded-full text-sm
    {% if order.status == 'DELIVERED' %}bg-green-100 text-green-700
    {% elif order.status == 'CANCELLED' %}bg-red-100 text-red-700
    {% else %}bg-blue-100 text-blue-700{% endif %}">
    {{ order.status }}
  </span>
</div>

{% include "orders/components/order_timeline.html" %}

<div class="p-6 grid md:grid-cols-3 gap-6">
  <div class="md:col-span-2">
    <p class="font-semibold mb-3">Items</p>
    <ul class="space-y-2 text-sm">
      {% for item in order.items.all %}
      <li class="flex justify-between">
        <span>{{ item.quantity }} × {{ item.product.name }}</span>
        <span>₹{{ item.subtotal }}</span>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div class="bg-gray-50 p-4 rounded-xl text-sm">
    <p class="flex justify-between mb-2">
      <span>Total</span><strong>₹{{ order.total }}</strong>
    </p>
    <p class="flex justify-between mb-2">
      <span>Payment</span>{{ order.payment_method }}
    </p>
    <p class="flex justify-between">
      <span>Status</span>{{ order.payment_status }}
    </p>
  </div>
</div>

<div class="px-6 py-4 border-t flex gap-3 text-sm">
  <a href="{% url 'orders:order_success' order.id %}"
     class="px-4 py-2 bg-black text-white rounded-lg">
    View Details
  </a>

  {% if order.can_cancel %}
  <button class="px-4 py-2 bg-red-100 text-red-600 rounded-lg">
    Cancel Order
  </button>
  {% endif %}

  <button class="px-4 py-2 bg-gray-100 rounded-lg">
    Download Invoice
  </button>
</div>

</div>
{% endwith %}
{% endfor %}

</div>
{% else %}
<p>No orders yet.</p>
{% endif %}

</div>
{% endblock %}