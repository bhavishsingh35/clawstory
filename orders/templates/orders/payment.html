{% extends "base.html" %}
{% block title %}Complete Payment | ClawStory{% endblock %}

{% block content %}

<!-- SEO -->
<meta name="description" content="Secure payment for your ClawStory order. Complete payment before session expires.">
<meta name="viewport" content="width=device-width, initial-scale=1">

<div class="min-h-[80vh] flex items-center justify-center bg-gray-100 px-4">

  <div
    class="w-full max-w-lg bg-white rounded-3xl shadow-xl p-8 text-center"
    data-seconds="{{ remaining_seconds|default:0 }}"
    data-fail-url="{% url 'orders:payment_failed' order.id %}"
  >

    <!-- HEADER -->
    <h1 class="text-2xl font-extrabold mb-1">Complete Payment</h1>
    <p class="text-sm text-gray-500 mb-6">
      Secure transaction â€¢ Session expires soon
    </p>

    <!-- ORDER INFO -->
    <div class="bg-gray-50 rounded-2xl p-5 mb-6 text-left text-sm">
      <div class="flex justify-between mb-2">
        <span class="text-gray-500">Order ID</span>
        <span class="font-semibold">#{{ order.id }}</span>
      </div>
      <div class="flex justify-between mb-2">
        <span class="text-gray-500">Amount Payable</span>
        <span class="font-semibold">â‚¹{{ order.total }}</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-500">Payment Method</span>
        <span class="font-semibold">{{ order.payment_method }}</span>
      </div>
    </div>

    <!-- TIMER -->
    <div class="mb-6">
      <p class="text-sm text-gray-600 mb-1">Time remaining</p>
      <p id="timer" class="text-2xl font-bold text-red-600">--:--</p>
    </div>

    <!-- PAYMENT ACTIONS -->
    <div class="space-y-3">

      <!-- âœ… DUMMY SUCCESS (replace with Razorpay later) -->
      <a
        id="payBtn"
        href="{% url 'orders:payment_success' order.id %}"
        class="block w-full bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition"
      >
        Pay Now (Dummy)
      </a>

      <!-- EXPIRED STATE -->
      <button
        id="expiredBtn"
        class="hidden w-full bg-gray-400 text-white py-3 rounded-xl font-semibold cursor-not-allowed"
      >
        Payment Session Expired
      </button>

    </div>

    <!-- TRUST -->
    <div class="mt-6 text-xs text-gray-500 space-y-1">
      <p>ðŸ”’ Secure & encrypted payment</p>
      <p>ðŸ’³ Powered by trusted gateways</p>
      <p>â†© Easy refunds if payment fails</p>
    </div>

  </div>

</div>

<!-- ================= TIMER SCRIPT ================= -->
<script>
  const container = document.querySelector("[data-seconds]");
  let seconds = parseInt(container.dataset.seconds);
  const failUrl = container.dataset.failUrl;

  const timerEl = document.getElementById("timer");
  const payBtn = document.getElementById("payBtn");
  const expiredBtn = document.getElementById("expiredBtn");

  function countdown() {
    if (seconds <= 0) {
      payBtn.classList.add("hidden");
      expiredBtn.classList.remove("hidden");
      window.location.href = failUrl;
      return;
    }

    let min = Math.floor(seconds / 60);
    let sec = seconds % 60;
    timerEl.innerText = ${min}:${sec < 10 ? "0" : ""}${sec};

    seconds--;
    setTimeout(countdown, 1000);
  }

  countdown();
</script>

{% endblock %}