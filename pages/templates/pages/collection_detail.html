{% extends "base.html" %}

{% block title %}{{ collection.name }} | The ClawStory{% endblock %}

{% block meta_description %}Shop {{ collection.name }} collection at The ClawStory. Premium fashion curated for modern style and comfort.{% endblock %}

{% block content %}
<div class="-mx-4 -my-10 px-4 py-12 bg-[#1a1a1a]">

<section class="max-w-7xl mx-auto" aria-labelledby="collection-heading">

  <!-- =====================================================
       COLLECTION HEADER
  ====================================================== -->
  <header class="mb-10">
    <h1 id="collection-heading"
        class="text-3xl md:text-4xl font-extrabold text-white tracking-wide">
      {{ collection.name }}
    </h1>
    <p class="text-gray-400 mt-1">
      {{ products.paginator.count }} products available
    </p>
  </header>

  {% if products %}
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">

    {% for product in products %}
    <article
      class="bg-white rounded-xl shadow-sm hover:shadow-lg transition overflow-hidden flex flex-col"
      itemscope
      itemtype="https://schema.org/Product"
    >

      <!-- =====================================================
           PRODUCT IMAGE
      ====================================================== -->
      <a
        href="{% url 'pages:product_detail' product.collection.slug product.slug %}"
        aria-label="View {{ product.name }}"
      >
        <div class="relative aspect-[3/4] bg-gray-100 overflow-hidden rounded-t-xl">
          {% if product.image_url %}
            <img
              src="{{ product.image_url }}"
              alt="{{ product.name }}"
              loading="lazy"
              width="600"
              height="800"
              class="absolute inset-0 w-full h-full object-cover transition-transform duration-300 hover:scale-105"
              itemprop="image"
            />
          {% else %}
            <div class="absolute inset-0 flex items-center justify-center text-gray-400 text-sm">
              No image available
            </div>
          {% endif %}
        </div>
      </a>

      <!-- =====================================================
           PRODUCT INFO
      ====================================================== -->
      <div class="p-4 flex flex-col flex-grow">

        <a
          href="{% url 'pages:product_detail' product.collection.slug product.slug %}"
        >
          <h2
            class="font-semibold text-gray-900 hover:underline line-clamp-2"
            itemprop="name"
          >
            {{ product.name }}
          </h2>
        </a>

        <!-- PRICE (Schema.org Offer) -->
        <p
          class="text-gray-800 mt-1 text-sm font-medium"
          itemprop="offers"
          itemscope
          itemtype="https://schema.org/Offer"
        >
          â‚¹{{ product.price }}
          <meta itemprop="priceCurrency" content="INR">
          <meta itemprop="price" content="{{ product.price }}">
          <meta itemprop="availability"
                content="https://schema.org/{% if product.is_in_stock %}InStock{% else %}OutOfStock{% endif %}">
        </p>

        {% if product.is_in_stock %}
          <span class="text-green-600 text-xs mt-1">
            In stock
          </span>
        {% else %}
          <span class="text-red-600 text-xs mt-1">
            Out of stock
          </span>
        {% endif %}

        <a
          href="{% url 'pages:product_detail' product.collection.slug product.slug %}"
          class="mt-auto block text-center
                 bg-[#111111] text-white
                 py-2 rounded-lg text-sm
                 hover:bg-black transition
                 focus:outline-none focus:ring-2 focus:ring-[#111111]"
        >
          View Product
        </a>

      </div>
    </article>
    {% endfor %}

  </div>

  <!-- =====================================================
       PAGINATION
  ====================================================== -->
  {% if products.paginator.num_pages > 1 %}
  <nav
    class="flex justify-center mt-12 gap-3 text-sm"
    aria-label="Pagination"
  >

    {% if products.has_previous %}
      <a
        href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ products.previous_page_number }}"
        class="px-4 py-2 rounded border border-gray-700
               text-gray-300 hover:bg-gray-800 transition"
        rel="prev"
      >
        Prev
      </a>
    {% endif %}

    <span class="px-4 py-2 text-gray-400">
      Page {{ products.number }} of {{ products.paginator.num_pages }}
    </span>

    {% if products.has_next %}
      <a
        href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ products.next_page_number }}"
        class="px-4 py-2 rounded border border-gray-700
               text-gray-300 hover:bg-gray-800 transition"
        rel="next"
      >
        Next
      </a>
    {% endif %}

  </nav>
  {% endif %}

  {% else %}
    <p class="text-gray-400">
      No products in this collection.
    </p>
  {% endif %}

</section>
</div>
{% endblock %}
